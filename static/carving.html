<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
		<meta name="keywords" content="BrickCarvingArtist, 砖雕艺术家" />
		<meta name="description" content="BrickCarvingArtist, 砖雕艺术家" />
		<meta name="author" content="BrickCarvingArtist, 砖雕艺术家" />
		<link rel="shortcut icon" type="image/ico" href="http://static.ikindness.cn/base/image/favicon.ico" />
		<title>学生线上项目构建工具</title>
	</head>
	<body>
		<input type="file" id="a" />
		<input type="button" value="克隆/更新仓库" id="b" />
		<input type="button" value="重启服务器" id="c" />
		<script src="/socket.io.js"></script>
		<script>
			!(() => {
				let git = io("/git");
				function log(){
					return console.log(...arguments);
				}
				git.on("message", data => {
					log(data);
				});
				a.onchange = (() => {
					let file, body;
					return e => {
						file = e.target.files[0];
						if(!file){
							return log("请上传学生github项目集合表！");
						}
						if(file.type.includes("csv")){
							body = new FormData;
							body.append("file", file);
							return fetch("/upload", {
								method : "post",
								body
							}).then(res => res.text()).then(message => log(message));
						}
						log("上传学生github项目集合表格式有误！");
					};
				})();
				b.onclick = () => {
					git.emit("ack", location.pathname.slice(1).replace("/", "."), res => log(res));
				};
				c.onclick = () => {
					fetch("/restart").then(res => res.text()).then(message => log(message));
				};
			})();
		</script>
	</body>
</html>